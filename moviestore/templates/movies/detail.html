{% block title %}TechFlix{% endblock %}
<head>
    {% load static %}
    <title>Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #header {
            padding: 10px;
            background-color: #f8f8f8;
            text-align: center;
        }
        #search {
            padding: 5px;
            width: 200px;
        }
        #result {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            width: 220px;
            max-height: 200px;
            overflow-y: auto;
        }
        .dropdown-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .movie-thumbnail {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }
        .movie-title {
            font-weight: bold;
        }
        .details-btn {
            display: block;
            text-decoration: none;
            color: blue;
            margin-top: 5px;
        }
        .movie {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px;
        }
    </style>
</head>
{% block content %}
  <div id="header">
    <a href="{% url 'index' %}">|Home|</a>
    <input type="text" id="search" placeholder="Search movies..." onkeyup="searchMovies()" />
  </div>
  <div id="result"></div>
{% endblock %}

{% block extra_js %}
<script>
  const movies = [
    {% for movie in movies %}
      {
        id: "{{ movie.id }}",
        title: "{{ movie.title }}",
        description: "{{ movie.description }}",
        image: "{% if movie.image %}{{ movie.image.url }}{% endif %}"
      }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];

  function searchMovies() {
    const input = document.getElementById('search').value.toLowerCase().trim();
    const resultContainer = document.getElementById('result');
    resultContainer.innerHTML = '';
    if (input === '') {
        resultContainer.style.display = 'none';
        return;
    }
    const filteredMovies = movies.filter(movie => movie.title.toLowerCase().includes(input));
    if (filteredMovies.length > 0) {
        resultContainer.style.display = 'block';
        filteredMovies.forEach(movie => {
            const movieItem = document.createElement('div');
            movieItem.classList.add('dropdown-item');

            const movieImg = document.createElement('img');
            movieImg.src = movie.image;
            movieImg.alt = movie.title;
            movieImg.classList.add('movie-thumbnail');

            const movieTitle = document.createElement('span');
            movieTitle.textContent = movie.title;
            movieTitle.classList.add('movie-title');

            const detailsButton = document.createElement('a');
            detailsButton.href = `/movies/${movie.id}/`;
            detailsButton.textContent = 'Details';
            detailsButton.classList.add('details-btn');

            movieItem.appendChild(movieImg);
            movieItem.appendChild(movieTitle);
            movieItem.appendChild(detailsButton);
            resultContainer.appendChild(movieItem);
        });
    } else {
        const message = document.createElement('p');
        message.textContent = 'No movies found.';
        message.classList.add('dropdown-item');
        resultContainer.appendChild(message);
        resultContainer.style.display = 'block';
    }
  }

  document.addEventListener("click", function(event) {
    const resultContainer = document.getElementById('result');
    if (!event.target.closest('#search') && !event.target.closest('#result')) {
        resultContainer.style.display = 'none';
    }
  });

  document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('result').style.display = 'none';
  });
</script>
{% endblock %}

<h2>{{ movie.title }}</h2>
<p>{{ movie.description }}</p>
<p>Price: ${{ movie.price }}</p>
<img src="{{ movie.image.url }}" alt="{{ movie.title }}">
 {% if in_cart%}
            <button disabled>Added to Cart</button>
        {% else %}
            <form method="POST" action="{% url 'add_to_cart' movie.id %}">
                {% csrf_token %}
                <button type="submit">Add to Cart</button>
            </form>
        {% endif %}
<a href="{% url 'index' %}">Back|</a>