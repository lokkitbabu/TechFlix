{% block title %}Search{% endblock %}

{% block content %}
  <!-- Search Bar -->
  <div id="header">
  <a href="{% url 'index' %}">|Home|</a>
    <input type="text" id="search" placeholder="Search movies..." onkeyup="searchMovies()" />
  </div>

  <!-- Container for Search Results -->
  <div id="result">
    <!-- When nothing is typed, you can either show all movies or nothing -->
    {% for movie in movies %}
      <div class="movie">
        <h2>{{ movie.title }}</h2>
        <p>{{ movie.description }}</p>
        <p>Price: ${{ movie.price }}</p>
        <img src="{{ movie.image.url }}" alt="{{ movie.title }}">
      </div>
    {% endfor %}
  </div>
{% endblock %}

{% block extra_js %}
<script>
  // Build the movies array from Django context data.
  // This array is used for client-side filtering.
  const movies = [
    {% for movie in movies %}
      {
        title: "{{ movie.title}}",
        image: "{% if movie.image %}{{ movie.image.url}}{% endif %}"
      }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];

  function searchMovies() {
    const input = document.getElementById('search');
    const filter = input.value.toLowerCase();
    const resultContainer = document.getElementById('result');

    // Clear the results container
    resultContainer.innerHTML = '';

    // Filter movies based on the title (you can also search in description if desired)
    const filteredMovies = movies.filter(movie => movie.title.toLowerCase().includes(filter));

    // If nothing is typed, you can show a message or all movies
    if (input.value.trim() === '') {
      // Option 1: Show all movies when the search field is empty.
      movies.forEach(displayMovie);
      return;
    }

    // If there are matching movies, display them
    if (filteredMovies.length) {
      filteredMovies.forEach(displayMovie);
    } else {
      // Optionally, display a "No results found" message
      const message = document.createElement('p');
      message.textContent = 'No movies found.';
      resultContainer.appendChild(message);
    }
  }

  // Helper function to create and display a movie element
  function displayMovie(movie) {
    const resultContainer = document.getElementById('result');

    const movieDiv = document.createElement('div');
    movieDiv.classList.add('movie');

    const title = document.createElement('h2');
    title.textContent = movie.title;
    movieDiv.appendChild(title);

    const description = document.createElement('p');
    description.textContent = movie.description;
    movieDiv.appendChild(description);

    const price = document.createElement('p');
    price.textContent = 'Price: $' + movie.price;
    movieDiv.appendChild(price);

    if (movie.image) {
      const img = document.createElement('img');
      img.src = movie.image;
      img.alt = movie.title;
      movieDiv.appendChild(img);
    }

    resultContainer.appendChild(movieDiv);
  }
</script>
{% endblock %}
